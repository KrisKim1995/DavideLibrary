{% extends 'main.html' %}
{% load static %}
{% block content %}
<!DOCTYPE html>
<html>
<head>
    <title>Create Attendance</title>
    {% block css %}
    <link rel="stylesheet" type="text/css" href="{% static 'styles/create_attendance.css' %}">
    <style>
        @font-face {
            font-family: 'Poppins';
            src: url('/static/styles/Poppins/Poppins-Medium.ttf') format('truetype');
        }
        </style>
    {% endblock %}
</head>

<body>
    <div class="overlay-container">
<div class="min-h-screen">
    <div class="card">
        <div class="card-header">
            <div class="logo-container">
                <img src="{% static 'images/hpdslogo.png' %}" alt="logo" style="width: 150px; height: 150px; border-radius: 50%;">
            </div>
            <h1 class="card-title">Welcome to DavideLib Connect</h1>
            <p class="card-description">Colawin Library Management System</p>
        </div>
        <div class="card-content">
            <form method="post" id="attendanceForm">  <!-- Added id -->
                {% csrf_token %}
                <div class="relative">
                    <span class="user-check-icon">ðŸ‘¤</span>
                    
                    <div class="input-container">
                        {{ form.borrower_uid_number }}  <!-- This will use the custom widget -->
                    </div>
                </div>
            
                <div class="buttons" style="text-align: center;">
                    <button type="submit" class="button">Save</button>
                    <a href="{% url 'attendance-list' %}" class="button-back" style="text-decoration: none; color: black;">Back to List</a>
                </div>
            </form>                    
            
        </div>
        <div class="card-footer">
            <p>Thank you for using our library services!</p>
        </div>
    </div>
</div>
</div>

<!-- Modal for welcome message -->
<div id="welcomeModal" class="modal">
    <div class="modal-overlay"></div>
    <div class="modal-content">
        <span class="close">&times;</span>
        <h1 style="color: #4CAF50; margin: 0; padding: 0;">Welcome!</h1>
        <p id="welcomeMessage" style="font-size: 24px; margin-bottom: 20px;">Thank you for logging in, <span id="borrowerName" style="font-weight: bold; font-size: 28px;"></span>!</p>
        <p style="font-size: 18px; color: #555;">Feel free to explore the Library.</p>
    </div>
</div>

<script>
    const form = document.getElementById('attendanceForm');
    const modal = document.getElementById('welcomeModal');
    const closeButton = document.querySelector('.close');
    const welcomeMessage = document.getElementById('welcomeMessage');
    const borrowerNameSpan = document.getElementById('borrowerName');

    form.addEventListener('submit', function(event) {
        event.preventDefault(); // Prevent form submission
        const formData = new FormData(form);

        fetch(form.action, {
            method: 'POST',
            body: formData,
            headers: {
                'X-CSRFToken': formData.get('csrfmiddlewaretoken')
            }
        })
        .then(response => {
            if (response.ok) {
                return response.json();
            }
            return response.json().then(errorData => {
                throw new Error(errorData.error || 'An error occurred.'); // Get the error message from the response
            });
        })
        .then(data => {
            // Assuming the server returns the borrower's name
            borrowerNameSpan.textContent = data.borrower_name;
            modal.style.display = "block"; // Show the modal
            
            // Hide the modal after 1.5 seconds and redirect
            setTimeout(() => {
                modal.style.display = "none"; // Close the modal
                window.location.href = "{% url 'create-attendance' %}"; // Redirect back to create attendance page
            }, 3000); // 1500 milliseconds = 1.5 seconds
        })
        .catch(error => {
            alert(error.message); // Alert the error message
            console.error('There has been a problem with your fetch operation:', error);
        });
    });

    closeButton.onclick = function() {
        modal.style.display = "none"; // Close the modal
        window.location.href = "{% url 'attendance-list' %}"; // Redirect to attendance list after closing the modal
    }

    window.onclick = function(event) {
        if (event.target === modal) {
            modal.style.display = "none"; // Close the modal if clicked outside
            window.location.href = "{% url 'attendance-list' %}"; // Redirect to attendance list after closing the modal
        }
    }
</script>


</body>
</html>
{% endblock %}
